<!DOCTYPE html>
<meta charset="utf-8">
<style>

/*
.chart rect {
  fill: steelblue;
}
*/
.chart .legend {
  fill: black;
  font: 14px sans-serif;
  text-anchor: start;
  font-size: 12px;
}

.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}

.chart .label {
  fill: black;
  font: 14px sans-serif;
  text-anchor: end;
}

.bar:hover {
  fill: brown;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}


</style>
<svg class="chart"></svg>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script>



var data = {
  labels: [
    'resilience', 'maintainability', 'accessibility',
    'uptime', 'functionality', 'impact'
  ],
  series: [
    {
      label: '2012',
      values: [4, 8, 15, 16, 23, 42]
    },
    {
      label: '2013',
      values: [12, 43, 22, 11, 73, 25]
    },
    {
      label: '2014',
      values: [31, 28, 14, 8, 15, 21]
    },]
};

var realdata = {"toxic":{"advice\/question":0.0305571519,"animals":0.0425189077,"anime\/manga":0.0433381919,"appearance":0.0321370698,"arts":0.0188461165,"autos":0.0236057128,"board_game":0.0171705025,"books":0.0327417119,"card_game":0.0215260645,"company\/website":0.0330981164,"crypto":0.0216759738,"drugs":0.0694279823,"education":0.0157944911,"electronics":0.0172793256,"finance\/money":0.0140026984,"food\/drink":0.0287069106,"geo":0.0278845567,"hardware\/tools":0.0219857177,"health":0.0606775371,"hobby":0.024199404,"meta":0.0998363479,"movies":0.0331046758,"music":0.0495443034,"other":0.0294908441,"parenting":0.0464743116,"politics\/viewpoint":0.0717276532,"profession":0.0252551335,"programming":0.0070936328,"religion\/supernatural":0.0316086978,"rpg":0.0167256045,"sex\/relationships":0.1125346917,"social_group":0.0708567473,"software":0.0151197391,"sports":0.0308712749,"stem":0.0106304902,"travel":0.0133951035,"tv_show":0.0552820047,"video_game":0.0475992868,"writing\/stories":0.1082860413},"severe_toxic":{"advice\/question":0.0001857638,"animals":0.000116791,"anime\/manga":0.0003015392,"appearance":0.0000748852,"arts":0.0000449165,"autos":0.0000710675,"board_game":0.0000391442,"books":0.0001208011,"card_game":0.0000785091,"company\/website":0.0001320018,"crypto":0.0001158219,"drugs":0.0005115712,"education":0.0000627688,"electronics":0.000041103,"finance\/money":0.0000178127,"food\/drink":0.0000709728,"geo":0.0001389355,"hardware\/tools":0.0000393353,"health":0.0004142293,"hobby":0.0000741313,"meta":0.0021953802,"movies":0.00017206,"music":0.0005246832,"other":0.0002026712,"parenting":0.0001308178,"politics\/viewpoint":0.000529355,"profession":0.0000964991,"programming":0.0000065885,"religion\/supernatural":0.000084406,"rpg":0.0000608399,"sex\/relationships":0.0010683419,"social_group":0.0004481967,"software":0.0000562747,"sports":0.0001269911,"stem":0.000018498,"travel":0.0000131267,"tv_show":0.0004056186,"video_game":0.0005440045,"writing\/stories":0.002270122},"obscene":{"advice\/question":0.0114381439,"animals":0.010966318,"anime\/manga":0.0224878672,"appearance":0.011202853,"arts":0.0059959589,"autos":0.0081200499,"board_game":0.0051047241,"books":0.0154133376,"card_game":0.0076111845,"company\/website":0.0171828119,"crypto":0.0100758178,"drugs":0.0429542002,"education":0.006966792,"electronics":0.0067196716,"finance\/money":0.0053864951,"food\/drink":0.009633347,"geo":0.0132210884,"hardware\/tools":0.0071029489,"health":0.030016952,"hobby":0.00842457,"meta":0.0636470576,"movies":0.0171975683,"music":0.0294632153,"other":0.0148618821,"parenting":0.0185024444,"politics\/viewpoint":0.0393515979,"profession":0.0120683489,"programming":0.0021950816,"religion\/supernatural":0.0120065103,"rpg":0.0051692369,"sex\/relationships":0.0693850425,"social_group":0.0377960269,"software":0.0063581645,"sports":0.0143247965,"stem":0.0033935095,"travel":0.002886027,"tv_show":0.0294858836,"video_game":0.0241297689,"writing\/stories":0.0627398344},"threat":{"advice\/question":0.0006959765,"animals":0.0004336823,"anime\/manga":0.0009626301,"appearance":0.0001076593,"arts":0.0001119796,"autos":0.0000882562,"board_game":0.0002616276,"books":0.000469444,"card_game":0.0001963069,"company\/website":0.0001500199,"crypto":0.000117694,"drugs":0.0006854314,"education":0.0001363583,"electronics":0.0000721078,"finance\/money":0.0000365544,"food\/drink":0.0001304183,"geo":0.0002222778,"hardware\/tools":0.0001597807,"health":0.0007340626,"hobby":0.0001909217,"meta":0.0017121657,"movies":0.0004675515,"music":0.0005911589,"other":0.0002441914,"parenting":0.0002917256,"politics\/viewpoint":0.000951013,"profession":0.0001304345,"programming":0.0000229491,"religion\/supernatural":0.0002758485,"rpg":0.0002752517,"sex\/relationships":0.0012487889,"social_group":0.000587744,"software":0.0000762549,"sports":0.0001967296,"stem":0.0000481851,"travel":0.000057745,"tv_show":0.0009212576,"video_game":0.0012503621,"writing\/stories":0.0027331448},"insult":{"advice\/question":0.005047242,"animals":0.0058690155,"anime\/manga":0.0076970841,"appearance":0.0038455197,"arts":0.0023047909,"autos":0.0028489443,"board_game":0.0018343878,"books":0.0048688983,"card_game":0.0029695995,"company\/website":0.0055974856,"crypto":0.0035974817,"drugs":0.0139050709,"education":0.0022991796,"electronics":0.0021775426,"finance\/money":0.0015455115,"food\/drink":0.0035993532,"geo":0.0046479595,"hardware\/tools":0.0027526854,"health":0.0110292206,"hobby":0.0032573187,"meta":0.0323575697,"movies":0.005087992,"music":0.0099826505,"other":0.0054783701,"parenting":0.006397421,"politics\/viewpoint":0.0147650097,"profession":0.004016594,"programming":0.000697863,"religion\/supernatural":0.0040280063,"rpg":0.0018833755,"sex\/relationships":0.0257089669,"social_group":0.0134465461,"software":0.0022469711,"sports":0.0047777246,"stem":0.0011993645,"travel":0.0014669918,"tv_show":0.0110325255,"video_game":0.0097436479,"writing\/stories":0.0306217882},"identity_hate":{"advice\/question":0.0008370476,"animals":0.0010015259,"anime\/manga":0.0012221094,"appearance":0.0005392865,"arts":0.0003605659,"autos":0.0003312108,"board_game":0.0003788605,"books":0.0007555376,"card_game":0.0003839888,"company\/website":0.0005512517,"crypto":0.0003715653,"drugs":0.0017580077,"education":0.0003033149,"electronics":0.0002250736,"finance\/money":0.0001490069,"food\/drink":0.0005121129,"geo":0.0008906649,"hardware\/tools":0.0003499504,"health":0.0014961126,"hobby":0.0004496696,"meta":0.0058777159,"movies":0.0007258652,"music":0.0015680504,"other":0.000676345,"parenting":0.0008706274,"politics\/viewpoint":0.003365546,"profession":0.0004757739,"programming":0.0000672043,"religion\/supernatural":0.001056091,"rpg":0.0003742749,"sex\/relationships":0.0042797112,"social_group":0.0037449589,"software":0.0002395928,"sports":0.0005552177,"stem":0.0001629835,"travel":0.0002019179,"tv_show":0.0017243344,"video_game":0.001504618,"writing\/stories":0.0058345914},"in_data":{"advice\/question":true,"animals":true,"anime\/manga":true,"appearance":true,"arts":true,"autos":true,"board_game":true,"books":true,"card_game":true,"company\/website":true,"crypto":true,"drugs":true,"education":true,"electronics":true,"finance\/money":true,"food\/drink":true,"geo":true,"hardware\/tools":true,"health":true,"hobby":true,"meta":true,"movies":true,"music":true,"other":true,"parenting":true,"politics\/viewpoint":true,"profession":true,"programming":true,"religion\/supernatural":true,"rpg":true,"sex\/relationships":true,"social_group":true,"software":true,"sports":true,"stem":true,"travel":true,"tv_show":true,"video_game":true,"writing\/stories":true}};
var realdata2 = {};
realdata2.labels = Object.keys(realdata["toxic"]);
realdata2.series = [{label: 'toxic', values:[]}, {label: 'severe_toxic', values:[]}, {label: 'insult', values:[]}, {label: 'identity_hate', values:[]}, {label: 'obscene', values:[]}, {label: 'threat', values:[]}];

console.log(realdata2.labels);
console.log(realdata2.series);

for (var j = 0; j < realdata2.labels.length; j++){
    for (var i = 0; i < realdata2.series.length; i++){
        // console.log(realdata2.series[i].label)
        // console.log(realdata[realdata2.series[i].label]);
        realdata2.series[i].values.push(realdata[realdata2.series[i].label][realdata2.labels[j]]);
    }
}
console.log(realdata2);
data = realdata2
var chartWidth       = 300,
    barHeight        = 20,
    groupHeight      = barHeight * data.series.length,
    gapBetweenGroups = 10,
    spaceForLabels   = 150,
    spaceForLegend   = 150;

var zipped = []


// Zip the series data together (first values, second values, etc.)
var zippedData = [];
for (var i=0; i<data.labels.length; i++) {
  for (var j=0; j<data.series.length; j++) {
    zippedData.push(data.series[j].values[i]);
  }
}
console.log(zippedData)

// Color scale
var color = d3.scale.category20();
var chartHeight = barHeight * zippedData.length + gapBetweenGroups * data.labels.length;

var x = d3.scale.linear()
    .domain([0, d3.max(zippedData)])
    .range([0, chartWidth]);

var y = d3.scale.linear()
    .range([chartHeight + gapBetweenGroups, 0]);

var yAxis = d3.svg.axis()
    .scale(y)
    .tickFormat('')
    .tickSize(0)
    .orient("left");


// Specify the chart area and dimensions
var chart = d3.select(".chart")
    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
    .attr("height", chartHeight);

// Create bars
var bar = chart.selectAll("g")
    .data(zippedData)
    .enter().append("g")
    .attr("transform", function(d, i) {
      return "translate(" + spaceForLabels + "," + (i * barHeight + gapBetweenGroups * (0.5 + Math.floor(i/data.series.length))) + ")";
    });

// Create rectangles of the correct width
bar.append("rect")
    .attr("fill", function(d,i) { return color(i % data.series.length); })
    .attr("class", "bar")
    .attr("width", x)
    .attr("height", barHeight - 1);

// Add text label in bar
bar.append("text")
    .attr("x", function(d) { return x(d) - 3; })
    .attr("y", barHeight / 2)
    .attr("fill", "red")
    .attr("dy", ".35em")
    .text(function(d) { return d; });

// Draw labels
bar.append("text")
    .attr("class", "label")
    .attr("x", function(d) { return - 10; })
    .attr("y", groupHeight / 2)
    .attr("dy", ".35em")
    .text(function(d,i) {
      if (i % data.series.length === 0)
        return data.labels[Math.floor(i/data.series.length)];
      else
        return ""});

chart.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(" + spaceForLabels + ", " + -gapBetweenGroups/2 + ")")
      .call(yAxis);

// Draw legend
var legendRectSize = 18,
    legendSpacing  = 4;

var legend = chart.selectAll('.legend')
    .data(data.series)
    .enter()
    .append('g')
    .attr('transform', function (d, i) {
        var height = legendRectSize + legendSpacing;
        var offset = -gapBetweenGroups/2;
        var horz = spaceForLabels + chartWidth + 40 - legendRectSize;
        var vert = i * height - offset;
        return 'translate(' + horz + ',' + vert + ')';
    });

legend.append('rect')
    .attr('width', legendRectSize)
    .attr('height', legendRectSize)
    .style('fill', function (d, i) { return color(i); })
    .style('stroke', function (d, i) { return color(i); });

legend.append('text')
    .attr('class', 'legend')
    .attr('x', legendRectSize + legendSpacing)
    .attr('y', legendRectSize - legendSpacing)
    .text(function (d) { return d.label; });

</script>